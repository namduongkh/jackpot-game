"use strict";angular.module("Jackpot",["ionic","LocalStorageModule"]).run(["$ionicPlatform",function(t){t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(t,n,e){t.state("app",{url:"/app",abstract:!0,templateUrl:"templates/menu.html",controller:"RootController as rootCtrl"}).state("app.jackpot",{url:"/jackpot",views:{menuContent:{templateUrl:"templates/jackpot.html",controller:"JackpotCtrl as jackpot"}}}).state("app.randomLog",{url:"/randomLog",views:{menuContent:{templateUrl:"templates/randomLog.html",controller:"JackpotCtrl as jackpot"}}}).state("app.nRandom",{url:"/nRandom",views:{menuContent:{templateUrl:"templates/nRandom.html",controller:"JackpotCtrl as jackpot"}}}).state("app.saveLog",{url:"/saveLog",views:{menuContent:{templateUrl:"templates/saveLog.html",controller:"JackpotCtrl as jackpot"}}}).state("app.statistic",{url:"/statistic",views:{menuContent:{templateUrl:"templates/statistic.html",controller:"StatisticCtrl as statistic"}}}).state("app.nRandomFast",{url:"/nRandomFast",views:{menuContent:{templateUrl:"templates/nRandomFast.html",controller:"JackpotCtrl as jackpot"}}}).state("app.winning",{url:"/winning",views:{menuContent:{templateUrl:"templates/winning.html",controller:"WinningController as winning"}}}).state("app.result",{url:"/result",views:{menuContent:{templateUrl:"templates/result.html",controller:"ResultController as result"}}}),n.otherwise("/app/jackpot"),e.setPrefix("Jackpot").setStorageCookie(18250,"/",!1)}]),function(){angular.module("Jackpot").directive("suggestNumber",function(){return{restrict:"AE",templateUrl:"./js/template/suggest-number.html"}})}(),function(){function t(t,n){return{statisticUrl:"http://vietlott.vn/vi/choi/mega-6-45/thong-ke/?FromDate=01%2F01%2F2016",resultUrl:"http://vietlott.vn/vi/trung-thuong/ket-qua-trung-thuong/mega-6-45/",winningUrl:"http://vietlott.vn/vi/trung-thuong/ket-qua-trung-thuong/mega-6-45/winning-numbers/"}}t.$inject=["localStorageService","$rootScope"],angular.module("Jackpot").service("ConfigSvc",t)}(),function(){function t(t,n){return{getSaveLog:function(){return t.get("saveLog")||[]},getRandomLog:function(){return t.get("randomLog")||{}},getStatistic:function(){return t.get("statistic")||null},setSaveLog:function(e){t.set("saveLog",e),n.$broadcast("REFRESH_SAVELOG",e)},setRandomLog:function(n){t.set("randomLog",n)},setStatistic:function(n){t.set("statistic",n)},getNumberData:function(t){var n=0,e=0,o=this.getRandomLog(),a=this.getStatistic();return o&&o[t]&&(n=o[t]),a&&a.data&&a.data[Number(t)]&&(e=Number(a.data[Number(t)].value)),{random:n,statistic:e}}}}t.$inject=["localStorageService","$rootScope"],angular.module("Jackpot").service("JackpotSvc",t)}(),function(){angular.module("Jackpot").filter("statisticNumber",function(){return function(t,n,e){return n&&t&&t.length&&(t=t.filter(function(t,e){if(t.key==Number(n))return t})),t.sort(function(t,n){switch(e){case 2:return n.key-t.key;case 3:return Number(t.value)==Number(n.value)?t.key-n.key:Number(t.value)-Number(n.value);case 4:return Number(t.value)==Number(n.value)?n.key-t.key:Number(n.value)-Number(t.value);default:return t.key-n.key}}),t}}).filter("randomNumber",function(){return function(t,n){return n&&t&&t.length?t.filter(function(t,e){if(Number(t.key)==Number(n))return t}):t}})}(),function(){function t(t,n,e,o,a,r,i,u){var l=this;l.processNumber=function(t){return t>=0&&t<10?"0"+t:t+""},l.openAddLogPopup=function(){l.logListErr=null;i.show({template:'                    <span ng-bind="rootCtrl.logListErr" class="popup-sub-title assertive"></span>                    <input type="text" ng-model="rootCtrl.logList" placeholder="Ví dụ: 1,5,10,25,32,44">',title:"Nhập dãy số",subTitle:"Nhập 6 số, mỗi số cách nhau bởi dấu phẩy (,)",scope:t,buttons:[{text:"Đóng"},{text:"<b>Lưu</b>",type:"button-positive",onTap:function(t){function n(n){l.logListErr=n,t.preventDefault()}l.logListErr=null;var e=/\d{1,2},\d{1,2},\d{1,2},\d{1,2},\d{1,2},\d{1,2}/gi;if(l.logList&&e.test(l.logList)){var o=l.logList.split(","),a=[];for(var r in o){var i=Number(o[r]);i&&i<=45&&a.push(i)}if(a=_.uniq(a),l.logList=a,6==l.logList.length){l.logList=l.logList.sort(function(t,n){return t-n}).join(",");var s=u.getSaveLog()||[];s.unshift(l.logList),u.setSaveLog(s),void 0,l.logList=null}else n("Dãy số phải có đúng 6 số")}else n("Vui lòng nhập đúng định dạng dãy số")}}]})}}t.$inject=["$scope","$timeout","$ionicHistory","$state","$rootScope","localStorageService","$ionicPopup","JackpotSvc"],angular.module("Jackpot").controller("RootController",t)}(),function(){function t(t,n,e,o,a,r){function i(t){g.saveLog=t||r.getSaveLog()||[]}function u(){g.randomLog=r.getRandomLog()||{}}function l(){g.renderRandom=null,g.result=g.defaultResult()}function s(t,n){g.result[t]=n,g.randomLog[n]||(g.randomLog[n]=0),g.randomLog[n]++,r.setRandomLog(g.randomLog)}function c(){if(g.nRandomCount!=g.allowMin&&g.nRandomCount%g.limitRandomOneTurn==0){if(g.stopNRandom(),t.$apply(),!confirm("Đã chạy "+g.nRandomCount+" lượt, bạn có muốn tiếp tục?"))return void(g.allowMin=g.nRandomCount);g.allowMin=g.nRandomCount,g.runNRandom()}g.nRandomCount++,g.renderRandom=Math.floor(45*Math.random()+1),g.nRandomLog[g.renderRandom]||(g.nRandomLog[g.renderRandom]=0),g.nRandomLog[g.renderRandom]++,g.randomLog[g.renderRandom]||(g.randomLog[g.renderRandom]=0),g.randomLog[g.renderRandom]++,r.setRandomLog(g.randomLog),g.getListRandomLog(6);var n=[];for(var e in g.nRandomLog)n.push({key:e,value:g.nRandomLog[e]});g.nRandomList=n.sort(function(t,n){return t.value!=n.value?n.value-t.value:Number(t.key)-Number(n.key)}).splice(0,6),g.suggestNumber=g.nRandomList.map(function(t){return t.key}).sort(function(t,n){return t-n}),g.suggestNumber=g.suggestNumber.concat(g.defaultResult()),g.suggestNumber=g.suggestNumber.splice(0,6),t.$apply()}var g=this;g.startLabel="Bắt đầu",g.step=0,g.disabled_random6=!1,g.defaultResult=function(){return[null,null,null,null,null,null]};var m=function(t){var n=Math.floor(Math.random()*(39+t)+(0+t));return n<10?"0"+n:n};g.render=function(){g.interval=setInterval(function(){g.result[g.step-1]=m(1),t.$apply()},50)},g.renderRandomNumber=function(){g.randomInterval=setInterval(function(){g.renderRandom=m(1),t.$apply()},50)},g.start=function(){if(g.checkFullResult()){if(!confirm("Bạn có chắc chắn bắt đầu lại?"))return;l()}if(g.startLabel="Ngẫu nhiên số thứ "+(g.step+1),0==g.step)g.render();else if(g.step>=1&&g.step<=6){for(var t=m(g.step).toString();-1!=g.result.indexOf(t)||Number(t)<1||Number(t)>45;)t=m(g.step).toString();if(s(g.step-1,t),6==g.step)return clearInterval(g.interval),g.startLabel="Bắt đầu",g.step=0,g.getListRandomLog(6),void g.result.sort(function(t,n){return t-n})}g.step++},g.quick=function(){if(g.checkFullResult()){if(!confirm("Bạn có chắc chắn ngẫu nhiên 6 số từ đầu?"))return;l()}if(g.disabled_random6=!0,g.renderRandomNumber(),0==g.step&&g.step++,g.step>=1&&g.step<=6)var n=setInterval(function(){for(var e=m(g.step).toString();-1!=g.result.indexOf(e)||Number(e)<1||Number(e)>45;)e=m(g.step).toString();s(g.step-1,e),6==g.step?(clearInterval(g.randomInterval),g.startLabel="Bắt đầu",g.step=0,g.result.sort(function(t,n){return t-n}),g.disabled_random6=!1,g.getListRandomLog(6),t.$apply(),clearInterval(n)):g.step++},250)},g.getRandomLog=function(t){return r.getNumberData(t).random},g.getStatisticLog=function(t){return r.getNumberData(t).statistic},g.getNRandomLog=function(t){if(t)return g.nRandomLog[t]||0},g.checkFullResult=function(){return 0==g.step&&-1==g.result.indexOf(null)},g.getListRandomLog=function(t){var n=[];for(var e in g.randomLog)n.push({key:e,value:g.randomLog[e]});n=n.sort(function(t,n){return t.value!=n.value?n.value-t.value:Number(t.key)-Number(n.key)}),g.listRandomLog=t?n.splice(0,t):n},g.save=function(t){(t=(t=t||g.result).join(","))&&(g.saveLog.unshift(),r.setSaveLog(g.saveLog))},g.checkSaved=function(t){var t=t||g.result;return-1!=g.saveLog.indexOf(t.join(","))},g.unSave=function(t){if(t){if(!confirm("Bạn có chắc chắn xóa dãy kết quả này?"))return;n=g.saveLog.indexOf(t.join(","))}else var n=g.saveLog.indexOf(g.result.join(","));n>-1&&(g.saveLog.splice(n,1),g.saveLogList&&g.saveLogList.length&&g.saveLogList.splice(n,1),r.setSaveLog(g.saveLog))},g.jackpotInit=function(){function t(){u(),i(),g.getListRandomLog(6)}t(),l(),o.$on("$stateChangeStart",function(n,e){t()})},g.randomLogInit=function(){if(u(),i(),g.getListRandomLog(),g.listRandomLog.length>=6){for(var t=[],n=0;n<6;n++)t.push(g.listRandomLog[n]);g.suggestNumber=t.splice(0,6).map(function(t){return t.key}).sort(function(t,n){return t-n})}},g.unSaveAll=function(){confirm("Bạn có chắc chắn xóa tất cả?")&&(g.saveLog=[],g.saveLogList=[],r.setSaveLog(g.saveLog))},g.clearRandomLog=function(){confirm("Bạn có chắc chắn xóa tất cả?")&&(g.randomLog={},r.setRandomLog(g.randomLog),g.getListRandomLog())},g.nRandomInit=function(){u(),i(),g.nRandomSpeed||(g.nRandomSpeed=500),g.renderRandom="01",g.runningNRandom=!1,g.nRandomCount=0,o.$on("$stateChangeStart",function(){g.stopNRandom()}),g.nRandomLog={},g.nRandomList=[],g.suggestNumber=g.defaultResult(),g.allowMin=0,g.limitRandomOneTurn=1e3},g.runNRandom=function(){g.runningNRandom=!0,g.nRandomInterval=setInterval(c,1100-g.nRandomSpeed)},g.stopNRandom=function(){clearInterval(g.nRandomInterval),g.runningNRandom=!1},g.saveLogInit=function(){u(),i(),g.saveLogList=g.saveLog.map(function(t){return t.split(",")}),o.$on("REFRESH_SAVELOG",function(t,n){g.saveLogInit()})},g.nRandomSpeedChange=function(){g.runningNRandom&&(clearInterval(g.nRandomInterval),g.nRandomInterval=setInterval(c,1100-g.nRandomSpeed))},g.renderNumber=function(t){return(t=Number(t))>=0&&t<10?"0"+t:t},g.fastInit=function(){u(),i(),g.fastCount||(g.fastCount=100),g.suggestNumber=[],g.nRandomLog={},g.nRandomList=[],g.nRandomCount=0},g.startFast=function(){g.fastCount<100&&(g.fastCount=100),g.fastCount>1e4&&(g.fastCount=1e4);for(var t=0;t<Number(g.fastCount);t++){var n=Math.floor(45*Math.random()+1);g.nRandomLog[n]||(g.nRandomLog[n]=0),g.nRandomLog[n]++,g.randomLog[n]||(g.randomLog[n]=0),g.randomLog[n]++}g.nRandomCount+=Number(g.fastCount),r.setRandomLog(g.randomLog),g.getListRandomLog(6);var e=[];for(var o in g.nRandomLog)e.push({key:o,value:g.nRandomLog[o]});g.nRandomList=e.sort(function(t,n){return t.value!=n.value?n.value-t.value:Number(t.key)-Number(n.key)}).splice(0,6),g.suggestNumber=g.nRandomList.map(function(t){return t.key}).sort(function(t,n){return t-n})}}t.$inject=["$scope","$timeout","localStorageService","$rootScope","$state","JackpotSvc"],angular.module("Jackpot").controller("JackpotCtrl",t)}(),function(){function t(t,n,e,o){var a=this,r=n.getStatistic();a.getStatisticData=function(){t({method:"GET",url:o.statisticUrl}).then(function(t){if(200==t.status){var e=[];t.data.replace(/<div\sstyle="float:\sleft;\sfont-weight:\sbold;\spadding-left:\s10px;\spadding-top:\s5px;">(\d+)<\/div>\s/g,function(t,n){e.push({key:e.length+1,value:n})}),a.statisticData=e,n.setStatistic({date:new Date,data:e})}}).catch(function(t){r&&r.data&&(a.statisticData=r.data),a.showAlert()})},r&&r.date&&new Date(r.date).toDateString()==(new Date).toDateString()?a.statisticData=r.data:a.getStatisticData(),a.showAlert=function(){e.alert({title:"Thông báo",template:'<div style="text-align: center;">Không cập nhật được dữ liệu thống kê, vui lòng kiểm tra truy cập Internet.</div>'})},a.sortOptions=[{name:"Số tăng dần",value:1},{name:"Số giảm dần",value:2},{name:"Xuất hiện tăng dần",value:3},{name:"Xuất hiện giảm dần",value:4}],a.sortCond=a.sortOptions[0].value}t.$inject=["$http","JackpotSvc","$ionicPopup","ConfigSvc"],angular.module("Jackpot").controller("StatisticCtrl",t)}(),function(){function t(t,n,e,o){var a=this;a.winningData="";var r=!1,i=null;a.getWinningData=function(o,u){u=u||function(){},t({method:"get",url:e.winningUrl+"/?p="+o}).then(function(t){200==t.status&&(t.data=t.data.replace(/\n/g,"").replace(/\s+/g," "),t.data.replace(/<table\sclass="table\stable-striped">.*<tbody>(.+)<\/tbody>.*<\/table>\s/g,function(t,e){e=e.replace(/href="[^"]+"/g,""),a.winningData=n.trustAsHtml(a.winningData+e),i&&i==e||(i=e,a.getWinningData(o+1))}))}).catch(function(t){r||(r=!0,a.showAlert())})},a.getWinningData(1),a.showAlert=function(){o.alert({title:"Thông báo",template:'<div style="text-align: center;">Không cập nhật được dữ liệu thống kê, vui lòng kiểm tra truy cập Internet.</div>'})}}t.$inject=["$http","$sce","ConfigSvc","$ionicPopup"],angular.module("Jackpot").controller("WinningController",t)}(),function(){function t(t,n,e,o){var a=this,r=!1;a.getResultData=function(){t({method:"get",url:e.resultUrl}).then(function(t){if(200==t.status){t.data=t.data.replace(/\n/g,"").replace(/\s+/g," ");var e=document.createElement("div");e.innerHTML=t.data;var o=e.getElementsByClassName("box-result-detail");a.resultDetail=n.trustAsHtml(o[0].outerHTML);var r=e.getElementsByClassName("result")[0].getElementsByClassName("table");a.resultPrize=n.trustAsHtml(r[0].outerHTML.replace(/href="[^"]+"/gi,""))}}).catch(function(t){r||(r=!0,a.showAlert())})},a.getResultData(),a.showAlert=function(){o.alert({title:"Thông báo",template:'<div style="text-align: center;">Không cập nhật được dữ liệu thống kê, vui lòng kiểm tra truy cập Internet.</div>'})}}t.$inject=["$http","$sce","ConfigSvc","$ionicPopup"],angular.module("Jackpot").controller("ResultController",t)}();